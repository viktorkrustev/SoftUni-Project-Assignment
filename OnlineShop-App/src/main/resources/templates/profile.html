<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профил</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/profile.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Great+Vibes&family=Sacramento&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<header>
    <div class="header-container">
        <h1>Profile</h1>
        <nav>
            <ul>
                <li><a th:href="@{/}" th:text="#{home.link}">Home</a></li>
                <li><a th:href="@{/products}" th:text="#{products.link}">Products</a></li>
                <li th:if="${#authorization.expression('isAuthenticated()')}"><a th:href="@{/cart}" th:text="#{cart.link}">Cart</a></li>
                <li th:if="${#authorization.expression('isAuthenticated()')}"><a th:href="@{/users/profile}" th:text="#{profile.link}">Profile</a></li>
                <li><a th:href="@{/about}" th:text="#{about.link}">About Us</a></li>
                <li th:if="${#authorization.expression('isAuthenticated()')}">
                    <form th:action="@{/users/logout}" method="post">
                        <button type="submit" class="logout-button" th:text="#{logout.button}">Logout</button>
                    </form>
                </li>
            </ul>
        </nav>
    </div>
</header>
<div class="color-stripe"></div>
<div class="container">
    <!-- Edit Button -->
    <button class="btn" onclick="toggleEdit()">Edit</button>



    <!-- Profile Image and Picture Upload Section -->
    <div class="profile-image-section">
        <img th:if="${user.profilePicture != null}" th:src="'data:image/jpeg;base64,' + ${user.profilePicture}" alt="Profile Picture" class="profile-picture" onerror="this.onerror=null; this.src='/images/default-profile.png'">
        <div th:unless="${user.profilePicture != null}" class="profile-icon">
            <i class="fas fa-user-circle"></i>
        </div>
    </div>
    <!-- Upload Profile Picture Section -->
    <div class="profile-section">
        <form th:action="@{/users/uploadProfilePicture}" method="post" enctype="multipart/form-data">
            <section for="profilePicture">Upload Profile Picture:</section>
            <input type="file" id="profilePicture" name="profilePicture" accept="image/*">
            <button type="submit">Upload</button>
        </form>
    </div>

    <!-- Profile Information -->
    <div class="profile-section" id="info-section">
        <div class="profile-info">
            <label>First Name:</label>
            <span id="first_name" th:text="${user.firstName}"></span>
        </div>
        <div class="profile-info">
            <label>Last Name:</label>
            <span id="last_name" th:text="${user.lastName}"></span>
        </div>
        <div class="profile-info">
            <label>Email:</label>
            <span id="email" th:text="${user.email}"></span>
        </div>
        <div class="profile-info">
            <label>Username:</label>
            <span id="username" th:text="${user.username}"></span>
        </div>
    </div>

    <!-- Profile Details Edit Form -->
    <!-- Profile Details Edit Form -->
    <div class="edit-form" id="edit-form">
        <form th:action="@{/users/updateProfile}" method="post">
            <div>
                <label for="edit-first_name">First Name:</label>
                <input type="text" id="edit-first_name" name="first_name" th:value="${user.firstName}">
            </div>
            <div>
                <label for="edit-last_name">Last Name:</label>
                <input type="text" id="edit-last_name" name="last_name" th:value="${user.lastName}">
            </div>
            <div>
                <label for="edit-email">Email:</label>
                <input type="email" id="edit-email" name="email" th:value="${user.email}">
            </div>
            <div>
                <label for="edit-username">Username:</label>
                <input type="text" id="edit-username" name="username" th:value="${user.username}">
            </div>
            <button type="submit">Save Changes</button>
            <button type="button" onclick="toggleEdit()">Cancel</button>
        </form>
    </div>



    <!-- Orders Section -->
    <button class="toggle-orders-button" id="toggle-orders-btn" onclick="toggleOrders()">Toggle My Orders</button>
    <div class="orders-section" id="orders-section">
        <h3>My Orders:</h3>
        <ul>
            <li th:if="${orders.isEmpty()}">No orders to show!</li>
            <li th:each="order : ${orders}">
                <p>Date purchase: <span th:text="'Date: ' + ${order.orderDate} + ', Total price: ' + ${order.totalAmount}">0.00</span>$</p>

                <ul>
                    <li th:each="product : ${order.products}">
                        <div class="product-item">
                            <img th:src="${product.imageUrl}" alt="Product Image">
                            <span th:text="${product.name}"></span>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<footer>
    <p>&copy; 2024 My Online Store. All rights reserved.</p>
</footer>

<script>
    function toggleEdit() {
        var infoSection = document.getElementById('info-section');
        var editForm = document.getElementById('edit-form');
        var profileSection = document.querySelector('.profile-section');
        var editButton = document.querySelector('.btn'); // Adjust selector if needed

        if (editForm.classList.contains('open')) {
            editForm.classList.remove('open');
            infoSection.style.display = 'block';
            profileSection.style.display = 'block'; // Show the profile section
            editButton.textContent = 'Edit';
        } else {
            editForm.classList.add('open');
            infoSection.style.display = 'none';
            profileSection.style.display = 'none'; // Hide the profile section
            editButton.textContent = 'Cancel';
        }
    }

    function toggleOrders() {
        var ordersSection = document.getElementById("orders-section");
        ordersSection.classList.toggle("open");

        var toggleButton = document.getElementById("toggle-orders-btn");
        if (ordersSection.classList.contains("open")) {
            toggleButton.textContent = "Hide My Orders";
        } else {
            toggleButton.textContent = "Toggle My Orders";
        }
    }
</script>

</body>
</html>
